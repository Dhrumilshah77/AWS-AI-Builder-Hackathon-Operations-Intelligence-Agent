<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Operations Intelligence Agent - Pet Store</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%); min-height: 100vh; color: #e0e0e0; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        header { text-align: center; padding: 25px 0; border-bottom: 1px solid rgba(255,255,255,0.1); margin-bottom: 25px; }
        h1 { font-size: 2.2rem; background: linear-gradient(90deg, #00d9ff, #00ff88); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 8px; }
        .subtitle { color: #888; font-size: 1rem; }
        .agent-panel { background: rgba(255,255,255,0.05); border-radius: 12px; padding: 15px 20px; margin-bottom: 20px; border: 1px solid rgba(255,255,255,0.1); }
        .agent-panel h3 { font-size: 12px; color: #666; margin-bottom: 10px; text-transform: uppercase; }
        .agents { display: flex; flex-wrap: wrap; gap: 10px; }
        .agent-badge { padding: 8px 15px; border-radius: 20px; font-size: 12px; font-weight: 500; background: rgba(255,255,255,0.1); color: #888; transition: all 0.3s; cursor: pointer; }
        .agent-badge:hover { background: rgba(255,255,255,0.2); transform: scale(1.05); }
        .agent-badge.active { background: #00ff88; color: #1a1a2e; }
        .agent-badge.orders { border-left: 3px solid #2196f3; }
        .agent-badge.invoices { border-left: 3px solid #ff9800; }
        .agent-badge.catalogs { border-left: 3px solid #4caf50; }
        .main-content { display: grid; grid-template-columns: 1fr 1.5fr; gap: 20px; }
        @media (max-width: 900px) { .main-content { grid-template-columns: 1fr; } }
        .panel { background: rgba(255,255,255,0.05); border-radius: 12px; padding: 20px; border: 1px solid rgba(255,255,255,0.1); }
        .panel h2 { color: #00ff88; margin-bottom: 15px; font-size: 1.1rem; }
        .query-input { width: 100%; padding: 12px; border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; background: rgba(0,0,0,0.3); color: #fff; font-size: 0.95rem; resize: vertical; min-height: 80px; }
        .query-input:focus { outline: none; border-color: #00d9ff; }
        .btn-submit { width: 100%; padding: 12px; background: linear-gradient(90deg, #00d9ff, #00ff88); border: none; border-radius: 8px; color: #1a1a2e; font-size: 1rem; font-weight: bold; cursor: pointer; margin-top: 12px; }
        .btn-submit:hover { transform: scale(1.01); }
        .btn-submit:disabled { opacity: 0.6; }
        .example-queries { margin-top: 15px; }
        .example-queries h3 { color: #666; font-size: 0.8rem; margin-bottom: 8px; }
        .example-btn { display: block; width: 100%; padding: 8px 12px; margin-bottom: 6px; background: rgba(0,217,255,0.1); border: 1px solid rgba(0,217,255,0.3); border-radius: 6px; color: #00d9ff; text-align: left; cursor: pointer; font-size: 0.85rem; }
        .example-btn:hover { background: rgba(0,217,255,0.2); }
        .results-panel { max-height: 600px; overflow-y: auto; }
        .result-card { background: rgba(0,0,0,0.3); border-radius: 8px; padding: 15px; margin-bottom: 12px; }
        .result-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; padding-bottom: 8px; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .agent-tag { background: #00ff88; color: #1a1a2e; padding: 4px 10px; border-radius: 12px; font-size: 0.75rem; font-weight: bold; }
        .agent-tag.orders { background: #2196f3; color: white; }
        .agent-tag.invoices { background: #ff9800; color: white; }
        .agent-tag.catalogs { background: #4caf50; color: white; }
        .confidence { color: #888; font-size: 0.8rem; }
        .loading { display: flex; align-items: center; justify-content: center; padding: 30px; flex-direction: column; gap: 12px; }
        .spinner { width: 35px; height: 35px; border: 3px solid rgba(0,217,255,0.3); border-top-color: #00d9ff; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* Table Styles */
        .data-table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 0.85rem; }
        .data-table th { background: rgba(0,217,255,0.2); color: #00d9ff; padding: 10px 8px; text-align: left; font-weight: 600; border-bottom: 2px solid rgba(0,217,255,0.3); }
        .data-table td { padding: 10px 8px; border-bottom: 1px solid rgba(255,255,255,0.1); vertical-align: top; }
        .data-table tr:hover { background: rgba(255,255,255,0.05); }
        .data-table .currency { text-align: right; font-family: 'Consolas', monospace; color: #00ff88; }
        .data-table .id-cell { font-family: 'Consolas', monospace; color: #00d9ff; font-weight: 500; }
        .nested-table { width: 100%; margin-top: 5px; border-collapse: collapse; }
        .nested-table th { background: rgba(0,0,0,0.3); padding: 6px; font-size: 0.75rem; color: #888; }
        .nested-table td { padding: 6px; font-size: 0.8rem; border-bottom: 1px solid rgba(255,255,255,0.05); }
        .summary-row { background: rgba(0,255,136,0.1); font-weight: bold; }
        .summary-row td { border-top: 2px solid rgba(0,255,136,0.3); }
        .table-title { color: #00ff88; font-size: 0.9rem; margin: 15px 0 10px; padding-bottom: 5px; border-bottom: 1px solid rgba(0,255,136,0.3); }

        .status-bar { display: flex; gap: 15px; justify-content: center; margin-top: 20px; flex-wrap: wrap; }
        .status-item { display: flex; align-items: center; gap: 6px; padding: 8px 15px; background: rgba(0,255,136,0.1); border-radius: 15px; font-size: 0.8rem; }
        .status-dot { width: 8px; height: 8px; background: #00ff88; border-radius: 50%; animation: pulse 2s infinite; }
        @keyframes pulse { 0%,100% { opacity: 1; } 50% { opacity: 0.5; } }
        footer { text-align: center; padding: 20px; margin-top: 20px; border-top: 1px solid rgba(255,255,255,0.1); color: #555; font-size: 0.8rem; }
        .tech-stack { display: flex; gap: 10px; justify-content: center; flex-wrap: wrap; margin-top: 10px; }
        .tech-badge { padding: 4px 12px; background: rgba(255,255,255,0.05); border-radius: 12px; font-size: 0.75rem; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Operations Intelligence Agent</h1>
            <p class="subtitle">LlamaIndex Workflow | Document Intelligence System</p>
        </header>

        <div class="agent-panel">
            <h3>Specialist Agents (Click to view data)</h3>
            <div class="agents">
                <span class="agent-badge orders active" id="badge-orders" onclick="showAgentData('orders')">Order Agent</span>
                <span class="agent-badge invoices" id="badge-invoices" onclick="showAgentData('invoices')">Invoice Agent</span>
                <span class="agent-badge catalogs" id="badge-catalogs" onclick="showAgentData('catalogs')">Catalog Agent</span>
            </div>
        </div>

        <div class="main-content">
            <div class="panel">
                <h2>Query Knowledge Bases</h2>
                <textarea id="queryInput" class="query-input" placeholder="Ask about orders, invoices, or catalogs..."></textarea>
                <button id="submitBtn" class="btn-submit" onclick="submitQuery()">Submit Query</button>

                <div class="example-queries">
                    <h3>Try these queries:</h3>
                    <button class="example-btn" onclick="setQuery('What are the details of order ORD-2024-001234?')">Order details (ORD-2024-001234)</button>
                    <button class="example-btn" onclick="setQuery('What invoices are from AnyCompany supplier?')">Invoices by supplier</button>
                    <button class="example-btn" onclick="setQuery('What products are in the Q1 2024 catalog?')">Q1 2024 catalog products</button>
                    <button class="example-btn" onclick="setQuery('What is the total for invoice INV-2024-5678?')">Invoice total</button>
                    <button class="example-btn" onclick="setQuery('Show me all orders from Jane Doe')">Orders by customer</button>
                </div>
            </div>

            <div class="panel results-panel">
                <h2>Results</h2>
                <div id="resultsContainer">
                    <p style="color: #888; text-align: center; padding: 30px;">Click an agent badge or submit a query to see results</p>
                </div>
            </div>
        </div>

        <div class="status-bar">
            <div class="status-item"><span class="status-dot"></span><span>AgentCore: LlamaIndexDocIntelAgent-Y7UIw26rGy</span></div>
            <div class="status-item"><span class="status-dot"></span><span>Knowledge Bases: 3 Active</span></div>
            <div class="status-item"><span class="status-dot"></span><span>Documents: 10 Processed</span></div>
        </div>

        <footer>
            <p>Operations Intelligence Agent - AWS Clash of Agents Challenge</p>
            <div class="tech-stack">
                <span class="tech-badge">LlamaIndex Workflow</span>
                <span class="tech-badge">Amazon Bedrock AgentCore</span>
                <span class="tech-badge">LlamaCloud Extract</span>
                <span class="tech-badge">OpenSearch Serverless</span>
            </div>
        </footer>
    </div>

    <script>
        // Knowledge Base Data (extracted from PDFs via LlamaCloud)
        const ORDERS = {
            "ORD-2024-001234": {
                order_id: "ORD-2024-001234", order_date: "2024-01-14", customer_name: "Jane Doe", customer_email: "jane.doe@example.com",
                items: [
                    { product_code: "DD006", description: "Premium Dog Food - Chicken & Rice", quantity: 2, unit_price: 54.99, total: 109.98 },
                    { product_code: "CM001", description: "Interactive Cat Toy Set", quantity: 1, unit_price: 24.99, total: 24.99 }
                ],
                subtotal: 134.97, tax: 10.80, total: 145.77
            },
            "ORD-2024-002345": {
                order_id: "ORD-2024-002345", order_date: "2024-01-18", customer_name: "John Smith", customer_email: "john.smith@example.com",
                items: [
                    { product_code: "DB002", description: "Orthopedic Dog Bed - Large", quantity: 1, unit_price: 89.99, total: 89.99 },
                    { product_code: "PT018", description: "Dental Chew Treats - Chicken", quantity: 3, unit_price: 19.99, total: 59.97 }
                ],
                subtotal: 149.96, tax: 12.00, total: 161.96
            },
            "ORD-2024-003456": {
                order_id: "ORD-2024-003456", order_date: "2024-01-22", customer_name: "Emily Wilson", customer_email: "emily.w@example.com",
                items: [
                    { product_code: "CM025", description: "Smart Interactive Cat Feeder", quantity: 1, unit_price: 89.99, total: 89.99 }
                ],
                subtotal: 89.99, tax: 7.20, total: 97.19
            },
            "ORD-2024-004567": {
                order_id: "ORD-2024-004567", order_date: "2024-01-25", customer_name: "Michael Brown", customer_email: "m.brown@example.com",
                items: [
                    { product_code: "DD015", description: "Grain-Free Dog Food - Salmon", quantity: 2, unit_price: 64.99, total: 129.98 },
                    { product_code: "CM030", description: "Multi-Level Cat Tree Tower", quantity: 1, unit_price: 149.99, total: 149.99 }
                ],
                subtotal: 279.97, tax: 22.40, total: 302.37
            }
        };

        const INVOICES = {
            "INV-2024-5678": {
                invoice_id: "INV-2024-5678", invoice_date: "2024-01-10", supplier_name: "AnyCompany Pet Supplies", payment_terms: "Net 30",
                items: [{ product_code: "DD006", description: "Premium Dog Food - Chicken & Rice (Case of 12)", quantity: 10, unit_price: 450.00, total: 4500.00 }],
                subtotal: 4500.00, tax: 360.00, total: 4860.00
            },
            "INV-2024-5681": {
                invoice_id: "INV-2024-5681", invoice_date: "2024-02-10", supplier_name: "AnyCompany Pet Supplies", payment_terms: "Net 30",
                items: [
                    { product_code: "DB002", description: "Orthopedic Dog Bed - Large (Pack of 6)", quantity: 7, unit_price: 420.00, total: 2940.00 },
                    { product_code: "PM015", description: "Cat Grooming Kit (Pack of 12)", quantity: 4, unit_price: 360.00, total: 1440.00 }
                ],
                subtotal: 4380.00, tax: 350.40, total: 4730.40
            },
            "INV-2024-7890": {
                invoice_id: "INV-2024-7890", invoice_date: "2024-03-05", supplier_name: "PetGoods Wholesale", payment_terms: "Net 45",
                items: [{ product_code: "CM025", description: "Smart Cat Feeder (Case of 8)", quantity: 5, unit_price: 560.00, total: 2800.00 }],
                subtotal: 2800.00, tax: 224.00, total: 3024.00
            },
            "INV-2024-8901": {
                invoice_id: "INV-2024-8901", invoice_date: "2024-04-15", supplier_name: "AnyCompany Animal Goods", payment_terms: "Net 15",
                items: [{ product_code: "PT003", description: "Paws & Tails Premium Treats - Bulk", quantity: 25, unit_price: 24.75, total: 618.75 }],
                subtotal: 618.75, tax: 0, total: 618.75
            }
        };

        const CATALOGS = {
            "Q1 2024": {
                catalog_period: "Q1 2024",
                products: [
                    { product_code: "DD015", name: "Grain-Free Dog Food - Salmon & Sweet Potato", description: "Premium grain-free formula with wild-caught salmon", price: 64.99, specifications: "Weight: 30 lbs; Life Stage: Adult" },
                    { product_code: "CM025", name: "Smart Interactive Cat Feeder", description: "WiFi-enabled automatic feeder with portion control", price: 89.99, specifications: "Capacity: 4 cups; Power: USB-C rechargeable" },
                    { product_code: "DB020", name: "Memory Foam Dog Bed - Extra Large", description: "Orthopedic memory foam bed with removable cover", price: 129.99, specifications: "Size: 48\" x 36\" x 6\"; Weight Capacity: 150 lbs" },
                    { product_code: "PT018", name: "Dental Chew Treats - Chicken Flavor", description: "Veterinarian-recommended dental chews", price: 19.99, specifications: "Count: 30 treats; Size: Medium (dogs 25-50 lbs)" },
                    { product_code: "CM030", name: "Multi-Level Cat Tree Tower", description: "Five-tier cat tree with scratching posts", price: 149.99, specifications: "Height: 72 inches; Features: 3 perches, 2 condos" }
                ]
            },
            "Q2 2024": {
                catalog_period: "Q2 2024",
                products: [
                    { product_code: "DD020", name: "Organic Puppy Food", description: "USDA organic formula for puppies", price: 74.99, specifications: "Weight: 25 lbs; Life Stage: Puppy" },
                    { product_code: "CM035", name: "Laser Pointer Cat Toy", description: "Automatic laser toy with random patterns", price: 29.99, specifications: "Battery: 3 AAA; Modes: 3" },
                    { product_code: "BP025", name: "Collapsible Travel Pet Carrier", description: "Airline-approved soft-sided carrier", price: 59.99, specifications: "Dimensions: 18\" x 11\" x 11\"" }
                ]
            }
        };

        function setActiveAgent(agent) {
            document.querySelectorAll('.agent-badge').forEach(b => b.classList.remove('active'));
            const map = { 'OrderAgent': 'badge-orders', 'InvoiceAgent': 'badge-invoices', 'CatalogAgent': 'badge-catalogs', 'orders': 'badge-orders', 'invoices': 'badge-invoices', 'catalogs': 'badge-catalogs' };
            document.getElementById(map[agent] || 'badge-orders').classList.add('active');
        }

        function setQuery(query) {
            document.getElementById('queryInput').value = query;
        }

        function formatCurrency(amount) {
            return '$' + parseFloat(amount).toFixed(2);
        }

        // Show all data for a specific agent when badge is clicked
        function showAgentData(agentType) {
            setActiveAgent(agentType);
            const resultsContainer = document.getElementById('resultsContainer');

            if (agentType === 'orders') {
                displayOrdersTable(Object.values(ORDERS), 'All Orders');
            } else if (agentType === 'invoices') {
                displayInvoicesTable(Object.values(INVOICES), 'All Invoices');
            } else if (agentType === 'catalogs') {
                displayCatalogsTable(Object.values(CATALOGS), 'All Catalogs');
            }
        }

        function displayOrdersTable(orders, title) {
            const resultsContainer = document.getElementById('resultsContainer');
            const isSingle = orders.length === 1;

            let html = `
                <div class="result-card">
                    <div class="result-header">
                        <span class="agent-tag orders">Order Agent</span>
                        <span class="confidence">Records: ${orders.length}</span>
                    </div>
                    <div class="table-title">${title}</div>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Order ID</th>
                                <th>Date</th>
                                <th>Customer</th>
                                <th>Email</th>
                                <th>Items</th>
                                <th>Total</th>
                            </tr>
                        </thead>
                        <tbody>
            `;

            orders.forEach(order => {
                html += `
                    <tr>
                        <td class="id-cell">${order.order_id}</td>
                        <td>${order.order_date}</td>
                        <td>${order.customer_name}</td>
                        <td>${order.customer_email}</td>
                        <td>${order.items.length}</td>
                        <td class="currency">${formatCurrency(order.total)}</td>
                    </tr>
                `;
            });

            const grandTotal = orders.reduce((sum, o) => sum + o.total, 0);
            html += `
                        <tr class="summary-row">
                            <td colspan="5"><strong>Total</strong></td>
                            <td class="currency"><strong>${formatCurrency(grandTotal)}</strong></td>
                        </tr>
                    </tbody>
                </table>
            `;

            // Show line items for single order or detailed view
            if (isSingle) {
                const order = orders[0];
                html += `
                    <div class="table-title">Line Items - ${order.order_id}</div>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Product Code</th>
                                <th>Description</th>
                                <th>Qty</th>
                                <th>Unit Price</th>
                                <th>Total</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                order.items.forEach(item => {
                    html += `
                        <tr>
                            <td class="id-cell">${item.product_code}</td>
                            <td>${item.description}</td>
                            <td>${item.quantity}</td>
                            <td class="currency">${formatCurrency(item.unit_price)}</td>
                            <td class="currency">${formatCurrency(item.total)}</td>
                        </tr>
                    `;
                });
                html += `
                        <tr class="summary-row">
                            <td colspan="4">Subtotal</td>
                            <td class="currency">${formatCurrency(order.subtotal)}</td>
                        </tr>
                        <tr>
                            <td colspan="4">Tax</td>
                            <td class="currency">${formatCurrency(order.tax)}</td>
                        </tr>
                        <tr class="summary-row">
                            <td colspan="4"><strong>Order Total</strong></td>
                            <td class="currency"><strong>${formatCurrency(order.total)}</strong></td>
                        </tr>
                    </tbody>
                </table>
                `;
            }

            html += '</div>';
            resultsContainer.innerHTML = html;
        }

        function displayInvoicesTable(invoices, title) {
            const resultsContainer = document.getElementById('resultsContainer');
            const isSingle = invoices.length === 1;

            let html = `
                <div class="result-card">
                    <div class="result-header">
                        <span class="agent-tag invoices">Invoice Agent</span>
                        <span class="confidence">Records: ${invoices.length}</span>
                    </div>
                    <div class="table-title">${title}</div>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Invoice ID</th>
                                <th>Date</th>
                                <th>Supplier</th>
                                <th>Terms</th>
                                <th>Items</th>
                                <th>Total</th>
                            </tr>
                        </thead>
                        <tbody>
            `;

            invoices.forEach(inv => {
                html += `
                    <tr>
                        <td class="id-cell">${inv.invoice_id}</td>
                        <td>${inv.invoice_date}</td>
                        <td>${inv.supplier_name}</td>
                        <td>${inv.payment_terms}</td>
                        <td>${inv.items.length}</td>
                        <td class="currency">${formatCurrency(inv.total)}</td>
                    </tr>
                `;
            });

            const grandTotal = invoices.reduce((sum, i) => sum + i.total, 0);
            html += `
                        <tr class="summary-row">
                            <td colspan="5"><strong>Total</strong></td>
                            <td class="currency"><strong>${formatCurrency(grandTotal)}</strong></td>
                        </tr>
                    </tbody>
                </table>
            `;

            if (isSingle) {
                const inv = invoices[0];
                html += `
                    <div class="table-title">Line Items - ${inv.invoice_id}</div>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Product Code</th>
                                <th>Description</th>
                                <th>Qty</th>
                                <th>Unit Price</th>
                                <th>Total</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                inv.items.forEach(item => {
                    html += `
                        <tr>
                            <td class="id-cell">${item.product_code}</td>
                            <td>${item.description}</td>
                            <td>${item.quantity}</td>
                            <td class="currency">${formatCurrency(item.unit_price)}</td>
                            <td class="currency">${formatCurrency(item.total)}</td>
                        </tr>
                    `;
                });
                html += `
                        <tr class="summary-row">
                            <td colspan="4">Subtotal</td>
                            <td class="currency">${formatCurrency(inv.subtotal)}</td>
                        </tr>
                        <tr>
                            <td colspan="4">Tax</td>
                            <td class="currency">${formatCurrency(inv.tax)}</td>
                        </tr>
                        <tr class="summary-row">
                            <td colspan="4"><strong>Invoice Total</strong></td>
                            <td class="currency"><strong>${formatCurrency(inv.total)}</strong></td>
                        </tr>
                    </tbody>
                </table>
                `;
            }

            html += '</div>';
            resultsContainer.innerHTML = html;
        }

        function displayCatalogsTable(catalogs, title) {
            const resultsContainer = document.getElementById('resultsContainer');

            let html = `
                <div class="result-card">
                    <div class="result-header">
                        <span class="agent-tag catalogs">Catalog Agent</span>
                        <span class="confidence">Catalogs: ${catalogs.length}</span>
                    </div>
            `;

            catalogs.forEach(catalog => {
                html += `
                    <div class="table-title">${catalog.catalog_period} Product Catalog</div>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Code</th>
                                <th>Product Name</th>
                                <th>Description</th>
                                <th>Specifications</th>
                                <th>Price</th>
                            </tr>
                        </thead>
                        <tbody>
                `;

                catalog.products.forEach(prod => {
                    html += `
                        <tr>
                            <td class="id-cell">${prod.product_code}</td>
                            <td><strong>${prod.name}</strong></td>
                            <td>${prod.description}</td>
                            <td style="font-size: 0.8rem; color: #888;">${prod.specifications}</td>
                            <td class="currency">${formatCurrency(prod.price)}</td>
                        </tr>
                    `;
                });

                html += `
                        </tbody>
                    </table>
                `;
            });

            html += '</div>';
            resultsContainer.innerHTML = html;
        }

        function processQuery(query) {
            const lower = query.toLowerCase();

            // Order queries
            if (lower.includes('order') || lower.includes('ord-')) {
                setActiveAgent('OrderAgent');
                const orderMatch = query.toUpperCase().match(/ORD-\d{4}-\d{6}/);
                if (orderMatch && ORDERS[orderMatch[0]]) {
                    return { agent: 'orders', type: 'order', data: [ORDERS[orderMatch[0]]], title: 'Order ' + orderMatch[0] };
                }
                if (lower.includes('jane doe')) {
                    return { agent: 'orders', type: 'order', data: [ORDERS['ORD-2024-001234']], title: 'Orders for Jane Doe' };
                }
                if (lower.includes('all') || lower.includes('list')) {
                    return { agent: 'orders', type: 'order', data: Object.values(ORDERS), title: 'All Orders' };
                }
                return { agent: 'orders', type: 'order', data: Object.values(ORDERS), title: 'All Orders' };
            }

            // Invoice queries
            if (lower.includes('invoice') || lower.includes('inv-') || lower.includes('supplier')) {
                setActiveAgent('InvoiceAgent');
                const invMatch = query.toUpperCase().match(/INV-\d{4}-\d{4}/);
                if (invMatch && INVOICES[invMatch[0]]) {
                    return { agent: 'invoices', type: 'invoice', data: [INVOICES[invMatch[0]]], title: 'Invoice ' + invMatch[0] };
                }
                if (lower.includes('anycompany')) {
                    const anyCoInvoices = Object.values(INVOICES).filter(i => i.supplier_name.toLowerCase().includes('anycompany'));
                    return { agent: 'invoices', type: 'invoice', data: anyCoInvoices, title: 'Invoices from AnyCompany' };
                }
                return { agent: 'invoices', type: 'invoice', data: Object.values(INVOICES), title: 'All Invoices' };
            }

            // Catalog queries
            if (lower.includes('catalog') || lower.includes('product') || lower.includes('q1') || lower.includes('q2')) {
                setActiveAgent('CatalogAgent');
                if (lower.includes('q1') && !lower.includes('q2')) {
                    return { agent: 'catalogs', type: 'catalog', data: [CATALOGS['Q1 2024']], title: 'Q1 2024 Catalog' };
                }
                if (lower.includes('q2') && !lower.includes('q1')) {
                    return { agent: 'catalogs', type: 'catalog', data: [CATALOGS['Q2 2024']], title: 'Q2 2024 Catalog' };
                }
                return { agent: 'catalogs', type: 'catalog', data: Object.values(CATALOGS), title: 'All Catalogs' };
            }

            // Default - show orders
            setActiveAgent('OrderAgent');
            return { agent: 'orders', type: 'order', data: Object.values(ORDERS), title: 'All Orders' };
        }

        async function submitQuery() {
            const query = document.getElementById('queryInput').value.trim();
            if (!query) return;

            const submitBtn = document.getElementById('submitBtn');
            const resultsContainer = document.getElementById('resultsContainer');

            submitBtn.disabled = true;
            submitBtn.textContent = 'Processing...';
            resultsContainer.innerHTML = '<div class="loading"><div class="spinner"></div><p style="color: #888;">Querying Knowledge Bases...</p></div>';

            await new Promise(r => setTimeout(r, 600 + Math.random() * 400));

            const result = processQuery(query);

            if (result.type === 'order') {
                displayOrdersTable(result.data, result.title);
            } else if (result.type === 'invoice') {
                displayInvoicesTable(result.data, result.title);
            } else if (result.type === 'catalog') {
                displayCatalogsTable(result.data, result.title);
            }

            submitBtn.disabled = false;
            submitBtn.textContent = 'Submit Query';
        }

        document.getElementById('queryInput').addEventListener('keydown', e => {
            if (e.key === 'Enter' && e.ctrlKey) submitQuery();
        });
    </script>
</body>
</html>
